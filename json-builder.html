<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kalvi Kraft – JSON Generator</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
    input, textarea, button { width: 100%; margin: 10px 0; padding: 10px; }
    button { background: #4a59e2; color: white; border: none; border-radius: 6px; }
    pre { background: #f4f4f4; padding: 15px; border: 1px solid #ccc; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>📁 GitHub Folder → 📄 JSON Generator</h2>

  <input type="text" id="folderUrl" placeholder="Paste GitHub folder URL (e.g. study-materials)" />

  <button onclick="generateJSON()">🔄 Generate JSON</button>

  <pre id="output">Your JSON will appear here...</pre>

  <button onclick="copyJSON()">📋 Copy JSON</button>

  <script>
    async function generateJSON() {
      const folderUrl = document.getElementById('folderUrl').value.trim();
      const output = document.getElementById('output');

      if (!url.includes("github.com") && !url.includes("api.github.com")) {
        alert("❌ Please paste a valid GitHub folder or API URL");
        return;
      }

      const [owner, repo, , , ...folderParts] = new URL(folderUrl).pathname.split('/');
      const folderPath = folderParts.slice(2).join('/');
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${folderPath}`;

      try {
        const res = await fetch(apiUrl);
        const files = await res.json();

        const json = files
          .filter(file => file.name.endsWith(".pdf"))
          .map(file => ({
            name: file.name.replace(/[-_]/g, ' ').replace('.pdf', ''),
            url: `https://raw.githubusercontent.com/${owner}/${repo}/main/${folderPath}/${file.name}`,
            subject: "",
            university: "KMC"
          }));

        output.textContent = JSON.stringify(json, null, 2);
      } catch (err) {
        output.textContent = "⚠️ Error fetching folder contents. Please check URL.";
      }
    }

    function copyJSON() {
      const text = document.getElementById("output").textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert("✅ JSON copied to clipboard!");
      });
    }
  </script>
</body>
</html>
